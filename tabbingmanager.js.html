<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="generator" content="HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
    <meta charset="utf-8">
    <title>
      Source: misc/tabbingmanager.js &#226;&#8364;&#8221;&#226;&#8364;&#175;Drupal JS API
    </title>
    <script src="scripts/prettify/prettify.js" type="text/javascript">
</script>
    <script src="scripts/prettify/lang-css.js" type="text/javascript">
</script>
    <link type="text/css" rel="stylesheet" href="pure/pure.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/drupal.css">
  </head>
  <body>
    <div id="main" class="pure">
      <div class="pure-g">
        <div class="pure-u-4-5">
          <div class="box">
            <h1 class="page-title">
              Source: misc/tabbingmanager.js
            </h1>
            <section>
              <article>
                <pre class="prettyprint source">
<code>/**
 * @file
 * Manages page tabbing modifications made by modules.
 */

(function ($, Drupal) {

"use strict";

/**
 * Provides an API for managing page tabbing order modifications.
 *
 * @constructor
 */
function TabbingManager () {
  /**
   * Tabbing sets are stored as a stack. The active set is at the top of the
   * stack. We use a JavaScript array as if it were a stack; we consider the
   * first element to be the bottom and the last element to be the top. This
   * allows us to use JavaScript's built-in Array.push() and Array.pop()
   * methods.
   *
   * @type {Array.&lt;TabbingManager&gt;}
   */
  this.stack = [];
}

/**
 * Add public methods to the TabbingManager class.
 */
$.extend(TabbingManager.prototype, /** @lends TabbingManager# */ {
  /**
   * Constrain tabbing to the specified set of elements only.
   *
   * Makes elements outside of the specified set of elements unreachable via the
   * tab key.
   *
   * @method TabbingManager.prototype.constrain
   * @param {jQueryElement[]} elements
   *   The set of elements to which tabbing should be constrained. Can also be
   *   a jQuery-compatible selector string.
   *
   * @return {TabbingContext}
   */
  constrain: function (elements) {
    // Deactivate all tabbingContexts to prepare for the new constraint. A
    // tabbingContext instance will only be reactivated if the stack is unwound
    // to it in the _unwindStack() method.
    for (var i = 0, il = this.stack.length; i &lt; il; i++) {
      this.stack[i].deactivate();
    }

    // The "active tabbing set" are the elements tabbing should be constrained
    // to.
    var $elements = $(elements).find(':tabbable').addBack(':tabbable');

    var tabbingContext = new TabbingContext({
      // The level is the current height of the stack before this new
      // tabbingContext is pushed on top of the stack.
      level: this.stack.length,
      $tabbableElements: $elements
    });

    this.stack.push(tabbingContext);

    // Activates the tabbingContext; this will manipulate the DOM to constrain
    // tabbing.
    tabbingContext.activate();

    // Allow modules to respond to the constrain event.
    $(document).trigger('drupalTabbingConstrained', tabbingContext);

    return tabbingContext;
  },

  /**
   * Restores a former tabbingContext when an active tabbingContext is released.
   *
   * The TabbingManager stack of tabbingContext instances will be unwound from
   * the top-most released tabbingContext down to the first non-released
   * tabbingContext instance. This non-released instance is then activated.
   */
  release: function () {
    // Unwind as far as possible: find the topmost non-released tabbingContext.
    var toActivate = this.stack.length - 1;
    while (toActivate &gt;= 0 &amp;&amp; this.stack[toActivate].released) {
      toActivate--;
    }

    // Delete all tabbingContexts after the to be activated one. They have
    // already been deactivated, so their effect on the DOM has been reversed.
    this.stack.splice(toActivate + 1);

    // Get topmost tabbingContext, if one exists, and activate it.
    if (toActivate &gt;= 0) {
      this.stack[toActivate].activate();
    }
  },

  /**
   * Makes all elements outside the of the tabbingContext's set untabbable.
   *
   * Elements made untabble have their original tabindex and autfocus values
   * stored so that they might be restored later when this tabbingContext
   * is deactivated.
   *
   * @param {TabbingContext} tabbingContext
   *   The TabbingContext instance that has been activated.
   */
  activate: function (tabbingContext) {
    var $set = tabbingContext.$tabbableElements;
    var level = tabbingContext.level;
    // Determine which elements are reachable via tabbing by default.
    var $disabledSet = $(':tabbable')
      // Exclude elements of the active tabbing set.
      .not($set);
    // Set the disabled set on the tabbingContext.
    tabbingContext.$disabledElements = $disabledSet;
    // Record the tabindex for each element, so we can restore it later.
    for (var i = 0, il = $disabledSet.length; i &lt; il; i++) {
      this.recordTabindex($disabledSet.eq(i), level);
    }
    // Make all tabbable elements outside of the active tabbing set unreachable.
    $disabledSet
      .prop('tabindex', -1)
      .prop('autofocus', false);

    // Set focus on an element in the tabbingContext's set of tabbable elements.
    // First, check if there is an element with an autofocus attribute. Select
    // the last one from the DOM order.
    var $hasFocus = $set.filter('[autofocus]').eq(-1);
    // If no element in the tabbable set has an autofocus attribute, select the
    // first element in the set.
    if ($hasFocus.length === 0) {
      $hasFocus = $set.eq(0);
    }
    $hasFocus.trigger('focus');
  },

  /**
   * Restores that tabbable state of a tabbingContext's disabled elements.
   *
   * Elements that were made untabble have their original tabindex and autfocus
   * values restored.
   *
   * @param {TabbingContext} tabbingContext
   *   The TabbingContext instance that has been deactivated.
   */
  deactivate: function (tabbingContext) {
    var $set = tabbingContext.$disabledElements;
    var level = tabbingContext.level;
    for (var i = 0, il = $set.length; i &lt; il; i++) {
      this.restoreTabindex($set.eq(i), level);
    }
  },

  /**
   * Records the tabindex and autofocus values of an untabbable element.
   *
   * @param {jQuery} $set
   *   The set of elements that have been disabled.
   * @param {Number} level
   *   The stack level for which the tabindex attribute should be recorded.
   */
  recordTabindex: function ($el, level) {
    var tabInfo = $el.data('drupalOriginalTabIndices') || {};
    tabInfo[level] = {
      tabindex: $el[0].getAttribute('tabindex'),
      autofocus: $el[0].hasAttribute('autofocus')
    };
    $el.data('drupalOriginalTabIndices', tabInfo);
  },

  /**
   * Restores the tabindex and autofocus values of a reactivated element.
   *
   * @param {jQueryObject} $el
   *   The element that is being reactivated.
   * @param {Number} level
   *   The stack level for which the tabindex attribute should be restored.
   */
  restoreTabindex: function ($el, level) {
    var tabInfo = $el.data('drupalOriginalTabIndices');
    if (tabInfo &amp;&amp; tabInfo[level]) {
      var data = tabInfo[level];
      if (data.tabindex) {
        $el[0].setAttribute('tabindex', data.tabindex);
      }
      // If the element did not have a tabindex at this stack level then
      // remove it.
      else {
        $el[0].removeAttribute('tabindex');
      }
      if (data.autofocus) {
        $el[0].setAttribute('autofocus', 'autofocus');
      }

      // Clean up $.data.
      if (level === 0) {
        // Remove all data.
       $el.removeData('drupalOriginalTabIndices');
      }
      else {
        // Remove the data for this stack level and higher.
        var levelToDelete = level;
        while (tabInfo.hasOwnProperty(levelToDelete)) {
          delete tabInfo[levelToDelete];
          levelToDelete++;
        }
        $el.data('drupalOriginalTabIndices', tabInfo);
      }
    }
  }
});

/**
 * Stores a set of tabbable elements.
 *
 * This constraint can be removed with the release() method.
 *
 * @constructor
 * @param {Object} options
 *   A set of initiating values that include:
 *
 *   - Number level: The level in the TabbingManager's stack of this
 *   tabbingContext.
 *   - jQuery $tabbableElements: The DOM elements that should be reachable via
 *   the tab key when this tabbingContext is active.
 *   - jQuery $disabledElements: The DOM elements that should not be reachable
 *   via the tab key when this tabbingContext is active.
 *   - Boolean released: A released tabbingContext can never be activated again.
 *   It will be cleaned up when the TabbingManager unwinds its stack.
 *   - Boolean active: When true, the tabbable elements of this tabbingContext
 *   will be reachable via the tab key and the disabled elements will not. Only
 *   one tabbingContext can be active at a time.
 */
function TabbingContext (options) {
  $.extend(this, {
    level: null,
    $tabbableElements: $(),
    $disabledElements: $(),
    released: false,
    active: false
  }, options);
}

/**
 * Add public methods to the TabbingContext class.
 */
$.extend(TabbingContext.prototype, /** @lends TabbinbContext# */ {
  /**
   * Releases this TabbingContext.
   *
   * Once a TabbingContext object is released, it can never be activated again.
   */
  release: function () {
    if (!this.released) {
      this.deactivate();
      this.released = true;
      Drupal.tabbingManager.release(this);
      // Allow modules to respond to the tabbingContext release event.
      $(document).trigger('drupalTabbingContextReleased', this);
    }
  },

  /**
   * Activates this TabbingContext.
   */
  activate: function () {
    // A released TabbingContext object can never be activated again.
    if (!this.active &amp;&amp; !this.released) {
      this.active = true;
      Drupal.tabbingManager.activate(this);
      // Allow modules to respond to the constrain event.
      $(document).trigger('drupalTabbingContextActivated', this);
    }
  },

  /**
   * Deactivates this TabbingContext.
   */
  deactivate: function () {
    if (this.active) {
      this.active = false;
      Drupal.tabbingManager.deactivate(this);
      // Allow modules to respond to the constrain event.
      $(document).trigger('drupalTabbingContextDeactivated', this);
    }
  }
});


// Mark this behavior as processed on the first pass and return if it is
// already processed.
if (Drupal.tabbingManager) {
  return;
}
/**
 * Provides an API for managing page tabbing order modifications.
 *
 * @type {TabbingManager}
 */
Drupal.tabbingManager = new TabbingManager();


}(jQuery, Drupal));
</code>
</pre>
              </article>
            </section>
          </div>
        </div>
        <nav class="pure-u-1-5">
          <div class="box">
            <h2>
              <a href="index.html">Index</a>
            </h2>
            <h3>
              Classes
            </h3>
            <ul>
              <li>
                <a href="Drupal.ajax.html">Drupal.ajax</a>
              </li>
              <li>
                <a href="Drupal.AjaxCommands.html">Drupal.AjaxCommands</a>
              </li>
              <li>
                <a href="Drupal.AjaxError.html">Drupal.AjaxError</a>
              </li>
              <li>
                <a href="Drupal.CollapsibleDetails.html">Drupal.CollapsibleDetails</a>
              </li>
              <li>
                <a href="Drupal.contextual.AuralView.html">Drupal.contextual.AuralView</a>
              </li>
              <li>
                <a href="Drupal.contextual.KeyboardView.html">Drupal.contextual.KeyboardView</a>
              </li>
              <li>
                <a href="Drupal.contextual.Model.html">Drupal.contextual.Model</a>
              </li>
              <li>
                <a href="Drupal.contextual.RegionView.html">Drupal.contextual.RegionView</a>
              </li>
              <li>
                <a href="Drupal.contextual.VisualView.html">Drupal.contextual.VisualView</a>
              </li>
              <li>
                <a href="Drupal.contextualToolbar.html#Model">Drupal.contextualToolbar.Model</a>
              </li>
              <li>
                <a href="Drupal.contextualToolbar.html#VisualView">Drupal.contextualToolbar.VisualView</a>
              </li>
              <li>
                <a href="Drupal.DropButton.html">Drupal.DropButton</a>
              </li>
              <li>
                <a href="Drupal.edit.AppModel.html">Drupal.edit.AppModel</a>
              </li>
              <li>
                <a href="Drupal.edit.AppView.html">Drupal.edit.AppView</a>
              </li>
              <li>
                <a href="Drupal.edit.ContextualLinkView.html">Drupal.edit.ContextualLinkView</a>
              </li>
              <li>
                <a href="Drupal.edit.EditorModel.html">Drupal.edit.EditorModel</a>
              </li>
              <li>
                <a href="Drupal.edit.editors.editor.html">Drupal.edit.editors.editor</a>
              </li>
              <li>
                <a href="Drupal.edit.editors.form.html">Drupal.edit.editors.form</a>
              </li>
              <li>
                <a href="Drupal.edit.editors.plain_text.html">Drupal.edit.editors.plain_text</a>
              </li>
              <li>
                <a href="Drupal.edit.EditorView.html">Drupal.edit.EditorView</a>
              </li>
              <li>
                <a href="Drupal.edit.EntityCollection.html">Drupal.edit.EntityCollection</a>
              </li>
              <li>
                <a href="Drupal.edit.EntityDecorationView.html">Drupal.edit.EntityDecorationView</a>
              </li>
              <li>
                <a href="Drupal.edit.EntityModel.html">Drupal.edit.EntityModel</a>
              </li>
              <li>
                <a href="Drupal.edit.EntityToolbarView.html">Drupal.edit.EntityToolbarView</a>
              </li>
              <li>
                <a href="Drupal.edit.FieldCollection.html">Drupal.edit.FieldCollection</a>
              </li>
              <li>
                <a href="Drupal.edit.FieldDecorationView.html">Drupal.edit.FieldDecorationView</a>
              </li>
              <li>
                <a href="Drupal.edit.FieldModel.html">Drupal.edit.FieldModel</a>
              </li>
              <li>
                <a href="Drupal.edit.FieldToolbarView.html">Drupal.edit.FieldToolbarView</a>
              </li>
              <li>
                <a href="Drupal.EditorFeature.html">Drupal.EditorFeature</a>
              </li>
              <li>
                <a href="Drupal.EditorFeatureHTMLRule.html">Drupal.EditorFeatureHTMLRule</a>
              </li>
              <li>
                <a href="Drupal.fieldUIDisplayOverview.field.html">Drupal.fieldUIDisplayOverview.field</a>
              </li>
              <li>
                <a href="Drupal.FilterHTMLRule.html">Drupal.FilterHTMLRule</a>
              </li>
              <li>
                <a href="Drupal.FilterStatus.html">Drupal.FilterStatus</a>
              </li>
              <li>
                <a href="Drupal.ProgressBar.html">Drupal.ProgressBar</a>
              </li>
              <li>
                <a href="Drupal.states.Dependent.html">Drupal.states.Dependent</a>
              </li>
              <li>
                <a href="Drupal.states.State.html">Drupal.states.State</a>
              </li>
              <li>
                <a href="Drupal.states.Trigger.html">Drupal.states.Trigger</a>
              </li>
              <li>
                <a href="Drupal.tableDrag.html">Drupal.tableDrag</a>
              </li>
              <li>
                <a href="Drupal.TableHeader.html">Drupal.TableHeader</a>
              </li>
              <li>
                <a href="Drupal.TableResponsive.html">Drupal.TableResponsive</a>
              </li>
              <li>
                <a href="Drupal.toolbar.BodyVisualView.html">Drupal.toolbar.BodyVisualView</a>
              </li>
              <li>
                <a href="Drupal.toolbar.MenuModel.html">Drupal.toolbar.MenuModel</a>
              </li>
              <li>
                <a href="Drupal.toolbar.MenuVisualView.html">Drupal.toolbar.MenuVisualView</a>
              </li>
              <li>
                <a href="Drupal.toolbar.ToolbarAuralView.html">Drupal.toolbar.ToolbarAuralView</a>
              </li>
              <li>
                <a href="Drupal.toolbar.ToolbarModel.html">Drupal.toolbar.ToolbarModel</a>
              </li>
              <li>
                <a href="Drupal.toolbar.ToolbarVisualView.html">Drupal.toolbar.ToolbarVisualView</a>
              </li>
              <li>
                <a href="Drupal.tour.models.StateModel.html">Drupal.tour.models.StateModel</a>
              </li>
              <li>
                <a href="Drupal.tour.views.ToggleTourView.html">Drupal.tour.views.ToggleTourView</a>
              </li>
              <li>
                <a href="Drupal.verticalTab.html">Drupal.verticalTab</a>
              </li>
              <li>
                <a href="Drupal.views.ajaxView.html">Drupal.views.ajaxView</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.AddItemForm.html">Drupal.viewsUi.AddItemForm</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.Checkboxifier.html">Drupal.viewsUi.Checkboxifier</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.FormFieldFiller.html">Drupal.viewsUi.FormFieldFiller</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.OptionsSearch.html">Drupal.viewsUi.OptionsSearch</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.RearrangeFilterHandler.html">Drupal.viewsUi.RearrangeFilterHandler</a>
              </li>
            </ul>
            <h3>
              Events
            </h3>
            <ul>
              <li>
                <a href="global.html#event:drupalViewportOffsetChange">event:drupalViewportOffsetChange</a>
              </li>
            </ul>
            <h3>
              Namespaces
            </h3>
            <ul>
              <li>
                <a href="Drupal.html" class="root">Drupal</a>
              </li>
              <li>
                <a href="Drupal.behaviors.html">Drupal.behaviors</a>
              </li>
              <li>
                <a href="Drupal.color.html">Drupal.color</a>
              </li>
              <li>
                <a href="Drupal.contextual.html">Drupal.contextual</a>
              </li>
              <li>
                <a href="Drupal.contextualToolbar.html">Drupal.contextualToolbar</a>
              </li>
              <li>
                <a href="Drupal.edit.html">Drupal.edit</a>
              </li>
              <li>
                <a href="Drupal.edit.metadata.html">Drupal.edit.metadata</a>
              </li>
              <li>
                <a href="Drupal.edit.util.html">Drupal.edit.util</a>
              </li>
              <li>
                <a href="Drupal.edit.util.constants.html">Drupal.edit.util.constants</a>
              </li>
              <li>
                <a href="Drupal.edit.util.form.html">Drupal.edit.util.form</a>
              </li>
              <li>
                <a href="Drupal.editorConfiguration.html">Drupal.editorConfiguration</a>
              </li>
              <li>
                <a href="Drupal.editors.html">Drupal.editors</a>
              </li>
              <li>
                <a href="Drupal.fieldUIDisplayOverview.html">Drupal.fieldUIDisplayOverview</a>
              </li>
              <li>
                <a href="Drupal.fieldUIOverview.html">Drupal.fieldUIOverview</a>
              </li>
              <li>
                <a href="Drupal.file.html">Drupal.file</a>
              </li>
              <li>
                <a href="Drupal.filterConfiguration.html">Drupal.filterConfiguration</a>
              </li>
              <li>
                <a href="Drupal.filterConfiguration.liveSettingParsers.html">Drupal.filterConfiguration.liveSettingParsers</a>
              </li>
              <li>
                <a href="Drupal.history.html">Drupal.history</a>
              </li>
              <li>
                <a href="Drupal.states.html">Drupal.states</a>
              </li>
              <li>
                <a href="Drupal.states.Trigger.states.html">Drupal.states.Trigger.states</a>
              </li>
              <li>
                <a href="Drupal.theme.html">Drupal.theme</a>
              </li>
              <li>
                <a href="Drupal.toolbar.html">Drupal.toolbar</a>
              </li>
              <li>
                <a href="Drupal.tour.html">Drupal.tour</a>
              </li>
              <li>
                <a href="Drupal.tour.models.html">Drupal.tour.models</a>
              </li>
              <li>
                <a href="Drupal.tour.views.html">Drupal.tour.views</a>
              </li>
              <li>
                <a href="Drupal.Views.html">Drupal.Views</a>
              </li>
              <li>
                <a href="Drupal.views_.html">Drupal.views</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.html">Drupal.viewsUi</a>
              </li>
            </ul>
            <h3>
              Global
            </h3>
            <ul>
              <li>
                <a href="global.html#drupalSettings" class="root">drupalSettings</a>
              </li>
              <li>
                <a href="global.html#matchMedia" class="root">matchMedia</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div><script type="text/javascript">
prettyPrint();
    </script><script src="scripts/linenumber.js" type="text/javascript">
</script>
  </body>
</html>
