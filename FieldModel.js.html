<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="generator" content="HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
    <meta charset="utf-8">
    <title>
      Source: modules/edit/js/models/FieldModel.js &#226;&#8364;&#8221;&#226;&#8364;&#175;Drupal JS API
    </title>
    <script src="scripts/prettify/prettify.js" type="text/javascript">
</script>
    <script src="scripts/prettify/lang-css.js" type="text/javascript">
</script>
    <link type="text/css" rel="stylesheet" href="pure/pure.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/drupal.css">
  </head>
  <body>
    <div id="main" class="pure">
      <div class="pure-g">
        <div class="pure-u-4-5">
          <div class="box">
            <h1 class="page-title">
              Source: modules/edit/js/models/FieldModel.js
            </h1>
            <section>
              <article>
                <pre class="prettyprint source">
<code>/**
 * @file
 * A Backbone Model for the state of an in-place editable field in the DOM.
 */

(function (_, Backbone, Drupal) {

"use strict";

Drupal.edit.FieldModel = Backbone.Model.extend(/** @lends Drupal.edit.FieldModel# */{

  /**
   * @type {Object}
   */
  defaults: {
    /**
    // The DOM element that represents this field. It may seem bizarre to have
    // a DOM element in a Backbone Model, but we need to be able to map fields
    // in the DOM to FieldModels in memory.
     * @name Drupal.edit.FieldModel#el
     * @type {?HTMLElement}
     * @virtual
     */
    el: null,
    /**
     * A field ID, of the form
     * `&lt;entity type&gt;/&lt;id&gt;/&lt;field name&gt;/&lt;language&gt;/&lt;view mode&gt;`, e.g.
     * `node/1/field_tags/und/full`.
     * @name Drupal.edit.FieldModel#fieldID
     * @type {?String}
     * @virtual
     */
    fieldID: null,
    /**
     * The unique ID of this field within its entity instance on the page, of
     * the form `&lt;entity type&gt;/&lt;id&gt;/&lt;field name&gt;/&lt;language&gt;/&lt;view mode&gt;[entity instance ID]`,
     * e.g. "node/1/field_tags/und/full[0]".
     * @name Drupal.edit.FieldModel#id
     * @type {?String}
     * @virtual
     */
    id: null,
    /**
     * A Drupal.edit.EntityModel. Its "fields" attribute, which is a
     * FieldCollection, is automatically updated to include this FieldModel.
     * @name Drupal.edit.FieldModel#entity
     * @type {?Drupal.edit.EntityModel}
     * @virtual
     */
    entity: null,
    /**
     * This field's metadata as returned by the EditController::metadata().
     * @name Drupal.edit.FieldModel#metadata
     * @type {?Object}
     * @virtual
     */
    metadata: null,
    /**
     * Callback function for validating changes between states. Receives the
     * previous state, new state, context, and a callback
     * @name Drupal.edit.FieldModel#acceptStateChange
     * @type {?Function}
     * @virtual
     */
    acceptStateChange: null,
    /**
     * A logical field ID, of the form
     * `&lt;entity type&gt;/&lt;id&gt;/&lt;field name&gt;/&lt;language&gt;`, i.e. the fieldID without
     * the view mode, to be able to identify other instances of the same field
     * on the page but rendered in a different view mode. e.g. `node/1/field_tags/und`.
     * @name Drupal.edit.FieldModel#logicalFieldID
     * @type {?String}
     * @virtual
     */
    logicalFieldID: null,

    /**
     * The attributes below are stateful. The ones above will never change
     * during the life of a FieldModel instance.
     *
     * In-place editing state of this field. Defaults to the initial state.
     * Possible values: {@linkto Drupal.edit.FieldModel.states}
     * @name Drupal.edit.FieldModel#state
     * @type {String}
     * @virtual
     */
    state: 'inactive',
    /**
     * The field is currently in the 'changed' state or one of the following
     * states in which the field is still changed.
     * @name Drupal.edit.FieldModel#isChanged
     * @type {Boolean}
     * @virtual
     */
    isChanged: false,
    /**
     * Is tracked by the EntityModel, is mirrored here solely for decorative
     * purposes: so that `FieldDecorationView.renderChanged()` can react to it.
     * @name Drupal.edit.FieldModel#inTempStore
     * @type {Boolean}
     * @virtual
     */
    inTempStore: false,
    /**
     * The full HTML representation of this field (with the element that has
     * the data-edit-field-id as the outer element). Used to propagate changes
     * from this field instance to other instances of the same field.
     * @name Drupal.edit.FieldModel#html
     * @type {?String}
     * @virtual
     */
    html: null,
    /**
     * An object containing the full HTML representations (values) of other view
     * modes (keys) of this field, for other instances of this field displayed
     * in a different view mode.
     * @name Drupal.edit.FieldModel#htmlForOtherViewModes
     * @type {Object.&lt;String&gt;}
     * @virtual
     */
    htmlForOtherViewModes: null
  },

  /**
   * State of an in-place editable field in the DOM.
   * @constructs Drupal.edit.FieldModel
   * @augments Backbone.Model
   */
  initialize: function (options) {
    // Store the original full HTML representation of this field.
    this.set('html', options.el.outerHTML);

    // Enlist field automatically in the associated entity's field collection.
    this.get('entity').get('fields').add(this);

    // Automatically generate the logical field ID.
    this.set('logicalFieldID', this.get('fieldID').split('/').slice(0, 4).join('/'));
  },

  /**
   * @method
   * @param options
   */
  destroy: function (options) {
    if (this.get('state') !== 'inactive') {
      throw new Error("FieldModel cannot be destroyed if it is not inactive state.");
    }
    Backbone.Model.prototype.destroy.call(this, options);
  },

  /**
   * @method
   */
  sync: function () {
    // We don't use REST updates to sync.
    return;
  },

  /**
   * @param {Object} attrs
   * @param {object} options
   */
  validate: function (attrs, options) {
    var current = this.get('state');
    var next = attrs.state;
    if (current !== next) {
      // Ensure it's a valid state.
      if (_.indexOf(this.constructor.states, next) === -1) {
        return '"' + next + '" is an invalid state';
      }
      // Check if the acceptStateChange callback accepts it.
      if (!this.get('acceptStateChange')(current, next, options, this)) {
        return 'state change not accepted';
      }
    }
  },

  /**
   * Extracts the entity ID from this field's ID.
   *
   * @return {String}
   *   An entity ID: a string of the format `&lt;entity type&gt;/&lt;id&gt;`.
   */
  getEntityID: function () {
    return this.get('fieldID').split('/').slice(0, 2).join('/');
  },

  /**
   * Extracts the view mode ID from this field's ID.
   *
   * @return {String}
   *   A view mode ID.
   */
  getViewMode: function () {
    return this.get('fieldID').split('/').pop();
  },

  /**
   * Find other instances of this field with different view modes.
   *
   * @return {Array}
   *   An array containing view mode IDs.
   */
  findOtherViewModes: function () {
    var currentField = this;
    var otherViewModes = [];
    Drupal.edit.collections.fields
      // Find all instances of fields that display the same logical field (same
      // entity, same field, just a different instance and maybe a different
      // view mode).
      .where({ logicalFieldID: currentField.get('logicalFieldID') })
      .forEach(function (field) {
        // Ignore the current field.
        if (field === currentField) {
          return;
        }
        // Also ignore other fields with the same view mode.
        else if (field.get('fieldID') === currentField.get('fieldID')) {
          return;
        }
        else {
          otherViewModes.push(field.getViewMode());
        }
      });
    return otherViewModes;
  }

}, /** @lends Drupal.edit.FieldModel */ {

  /**
   * A list (sequence) of all possible states a field can be in during in-place
   * editing.
   * @type {Array}
   */
  states: [
    // The field associated with this FieldModel is linked to an EntityModel;
    // the user can choose to start in-place editing that entity (and
    // consequently this field). No in-place editor (EditorView) is associated
    // with this field, because this field is not being in-place edited.
    // This is both the initial (not yet in-place editing) and the end state (
    // finished in-place editing).
    'inactive',
    // The user is in-place editing this entity, and this field is a candidate
    // for in-place editing. In-place editor should not
    // - Trigger: user.
    // - Guarantees: entity is ready, in-place editor (EditorView) is associated
    //   with the field.
    // - Expected behavior: visual indicators around the field indicate it is
    //   available for in-place editing, no in-place editor presented yet.
    'candidate',
    // User is highlighting this field.
    // - Trigger: user.
    // - Guarantees: see 'candidate'.
    // - Expected behavior: visual indicators to convey highlighting, in-place
    //   editing toolbar shows field's label.
    'highlighted',
    // User has activated the in-place editing of this field; in-place editor is
    // activating.
    // - Trigger: user.
    // - Guarantees: see 'candidate'.
    // - Expected behavior: loading indicator, in-place editor is loading remote
    //   data (e.g. retrieve form from back-end). Upon retrieval of remote data,
    //   the in-place editor transitions the field's state to 'active'.
    'activating',
    // In-place editor has finished loading remote data; ready for use.
    // - Trigger: in-place editor.
    // - Guarantees: see 'candidate'.
    // - Expected behavior: in-place editor for the field is ready for use.
    'active',
    // User has modified values in the in-place editor.
    // - Trigger: user.
    // - Guarantees: see 'candidate', plus in-place editor is ready for use.
    // - Expected behavior: visual indicator of change.
    'changed',
    // User is saving changed field data in in-place editor to TempStore. The
    // save mechanism of the in-place editor is called.
    // - Trigger: user.
    // - Guarantees: see 'candidate' and 'active'.
    // - Expected behavior: saving indicator, in-place editor is saving field
    //   data into TempStore. Upon successful saving (without validation
    //   errors), the in-place editor transitions the field's state to 'saved',
    //   but to 'invalid' upon failed saving (with validation errors).
    'saving',
    // In-place editor has successfully saved the changed field.
    // - Trigger: in-place editor.
    // - Guarantees: see 'candidate' and 'active'.
    // - Expected behavior: transition back to 'candidate' state because the
    //   deed is done. Then: 1) transition to 'inactive' to allow the field to
    //   be rerendered, 2) destroy the FieldModel (which also destroys attached
    //   views like the EditorView), 3) replace the existing field HTML with the
    //   existing HTML and 4) attach behaviors again so that the field becomes
    //   available again for in-place editing.
    'saved',
    // In-place editor has failed to saved the changed field: there were
    // validation errors.
    // - Trigger: in-place editor.
    // - Guarantees: see 'candidate' and 'active'.
    // - Expected behavior: remain in 'invalid' state, let the user make more
    //   changes so that he can save it again, without validation errors.
    'invalid'
  ],

  /**
   * Indicates whether the 'from' state comes before the 'to' state.
   *
   * @param {String} from
   *   One of Drupal.edit.FieldModel.states.
   * @param {String} to
   *   One of Drupal.edit.FieldModel.states.
   * @return Boolean
   */
  followsStateSequence: function (from, to) {
    return _.indexOf(this.states, from) &lt; _.indexOf(this.states, to);
  }

});

/**
 * @class
 * @augments Backbone.Collection
 */
Drupal.edit.FieldCollection = Backbone.Collection.extend(/** @lends Drupal.edit.FieldCollection# */ {
  /**
   * @type {Drupal.edit.FieldModel}
   */
  model: Drupal.edit.FieldModel
});

}(_, Backbone, Drupal));
</code>
</pre>
              </article>
            </section>
          </div>
        </div>
        <nav class="pure-u-1-5">
          <div class="box">
            <h2>
              <a href="index.html">Index</a>
            </h2>
            <h3>
              Classes
            </h3>
            <ul>
              <li>
                <a href="Drupal.ajax.html">Drupal.ajax</a>
              </li>
              <li>
                <a href="Drupal.AjaxCommands.html">Drupal.AjaxCommands</a>
              </li>
              <li>
                <a href="Drupal.AjaxError.html">Drupal.AjaxError</a>
              </li>
              <li>
                <a href="Drupal.CollapsibleDetails.html">Drupal.CollapsibleDetails</a>
              </li>
              <li>
                <a href="Drupal.contextual.AuralView.html">Drupal.contextual.AuralView</a>
              </li>
              <li>
                <a href="Drupal.contextual.KeyboardView.html">Drupal.contextual.KeyboardView</a>
              </li>
              <li>
                <a href="Drupal.contextual.Model.html">Drupal.contextual.Model</a>
              </li>
              <li>
                <a href="Drupal.contextual.RegionView.html">Drupal.contextual.RegionView</a>
              </li>
              <li>
                <a href="Drupal.contextual.VisualView.html">Drupal.contextual.VisualView</a>
              </li>
              <li>
                <a href="Drupal.contextualToolbar.html#Model">Drupal.contextualToolbar.Model</a>
              </li>
              <li>
                <a href="Drupal.contextualToolbar.html#VisualView">Drupal.contextualToolbar.VisualView</a>
              </li>
              <li>
                <a href="Drupal.DropButton.html">Drupal.DropButton</a>
              </li>
              <li>
                <a href="Drupal.edit.AppModel.html">Drupal.edit.AppModel</a>
              </li>
              <li>
                <a href="Drupal.edit.AppView.html">Drupal.edit.AppView</a>
              </li>
              <li>
                <a href="Drupal.edit.ContextualLinkView.html">Drupal.edit.ContextualLinkView</a>
              </li>
              <li>
                <a href="Drupal.edit.EditorModel.html">Drupal.edit.EditorModel</a>
              </li>
              <li>
                <a href="Drupal.edit.editors.editor.html">Drupal.edit.editors.editor</a>
              </li>
              <li>
                <a href="Drupal.edit.editors.form.html">Drupal.edit.editors.form</a>
              </li>
              <li>
                <a href="Drupal.edit.editors.plain_text.html">Drupal.edit.editors.plain_text</a>
              </li>
              <li>
                <a href="Drupal.edit.EditorView.html">Drupal.edit.EditorView</a>
              </li>
              <li>
                <a href="Drupal.edit.EntityCollection.html">Drupal.edit.EntityCollection</a>
              </li>
              <li>
                <a href="Drupal.edit.EntityDecorationView.html">Drupal.edit.EntityDecorationView</a>
              </li>
              <li>
                <a href="Drupal.edit.EntityModel.html">Drupal.edit.EntityModel</a>
              </li>
              <li>
                <a href="Drupal.edit.EntityToolbarView.html">Drupal.edit.EntityToolbarView</a>
              </li>
              <li>
                <a href="Drupal.edit.FieldCollection.html">Drupal.edit.FieldCollection</a>
              </li>
              <li>
                <a href="Drupal.edit.FieldDecorationView.html">Drupal.edit.FieldDecorationView</a>
              </li>
              <li>
                <a href="Drupal.edit.FieldModel.html">Drupal.edit.FieldModel</a>
              </li>
              <li>
                <a href="Drupal.edit.FieldToolbarView.html">Drupal.edit.FieldToolbarView</a>
              </li>
              <li>
                <a href="Drupal.EditorFeature.html">Drupal.EditorFeature</a>
              </li>
              <li>
                <a href="Drupal.EditorFeatureHTMLRule.html">Drupal.EditorFeatureHTMLRule</a>
              </li>
              <li>
                <a href="Drupal.fieldUIDisplayOverview.field.html">Drupal.fieldUIDisplayOverview.field</a>
              </li>
              <li>
                <a href="Drupal.FilterHTMLRule.html">Drupal.FilterHTMLRule</a>
              </li>
              <li>
                <a href="Drupal.FilterStatus.html">Drupal.FilterStatus</a>
              </li>
              <li>
                <a href="Drupal.ProgressBar.html">Drupal.ProgressBar</a>
              </li>
              <li>
                <a href="Drupal.states.Dependent.html">Drupal.states.Dependent</a>
              </li>
              <li>
                <a href="Drupal.states.State.html">Drupal.states.State</a>
              </li>
              <li>
                <a href="Drupal.states.Trigger.html">Drupal.states.Trigger</a>
              </li>
              <li>
                <a href="Drupal.tableDrag.html">Drupal.tableDrag</a>
              </li>
              <li>
                <a href="Drupal.TableHeader.html">Drupal.TableHeader</a>
              </li>
              <li>
                <a href="Drupal.TableResponsive.html">Drupal.TableResponsive</a>
              </li>
              <li>
                <a href="Drupal.toolbar.BodyVisualView.html">Drupal.toolbar.BodyVisualView</a>
              </li>
              <li>
                <a href="Drupal.toolbar.MenuModel.html">Drupal.toolbar.MenuModel</a>
              </li>
              <li>
                <a href="Drupal.toolbar.MenuVisualView.html">Drupal.toolbar.MenuVisualView</a>
              </li>
              <li>
                <a href="Drupal.toolbar.ToolbarAuralView.html">Drupal.toolbar.ToolbarAuralView</a>
              </li>
              <li>
                <a href="Drupal.toolbar.ToolbarModel.html">Drupal.toolbar.ToolbarModel</a>
              </li>
              <li>
                <a href="Drupal.toolbar.ToolbarVisualView.html">Drupal.toolbar.ToolbarVisualView</a>
              </li>
              <li>
                <a href="Drupal.tour.models.StateModel.html">Drupal.tour.models.StateModel</a>
              </li>
              <li>
                <a href="Drupal.tour.views.ToggleTourView.html">Drupal.tour.views.ToggleTourView</a>
              </li>
              <li>
                <a href="Drupal.verticalTab.html">Drupal.verticalTab</a>
              </li>
              <li>
                <a href="Drupal.views.ajaxView.html">Drupal.views.ajaxView</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.AddItemForm.html">Drupal.viewsUi.AddItemForm</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.Checkboxifier.html">Drupal.viewsUi.Checkboxifier</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.FormFieldFiller.html">Drupal.viewsUi.FormFieldFiller</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.OptionsSearch.html">Drupal.viewsUi.OptionsSearch</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.RearrangeFilterHandler.html">Drupal.viewsUi.RearrangeFilterHandler</a>
              </li>
            </ul>
            <h3>
              Events
            </h3>
            <ul>
              <li>
                <a href="global.html#event:drupalViewportOffsetChange">event:drupalViewportOffsetChange</a>
              </li>
            </ul>
            <h3>
              Namespaces
            </h3>
            <ul>
              <li>
                <a href="Drupal.html" class="root">Drupal</a>
              </li>
              <li>
                <a href="Drupal.behaviors.html">Drupal.behaviors</a>
              </li>
              <li>
                <a href="Drupal.color.html">Drupal.color</a>
              </li>
              <li>
                <a href="Drupal.contextual.html">Drupal.contextual</a>
              </li>
              <li>
                <a href="Drupal.contextualToolbar.html">Drupal.contextualToolbar</a>
              </li>
              <li>
                <a href="Drupal.edit.html">Drupal.edit</a>
              </li>
              <li>
                <a href="Drupal.edit.metadata.html">Drupal.edit.metadata</a>
              </li>
              <li>
                <a href="Drupal.edit.util.html">Drupal.edit.util</a>
              </li>
              <li>
                <a href="Drupal.edit.util.constants.html">Drupal.edit.util.constants</a>
              </li>
              <li>
                <a href="Drupal.edit.util.form.html">Drupal.edit.util.form</a>
              </li>
              <li>
                <a href="Drupal.editorConfiguration.html">Drupal.editorConfiguration</a>
              </li>
              <li>
                <a href="Drupal.editors.html">Drupal.editors</a>
              </li>
              <li>
                <a href="Drupal.fieldUIDisplayOverview.html">Drupal.fieldUIDisplayOverview</a>
              </li>
              <li>
                <a href="Drupal.fieldUIOverview.html">Drupal.fieldUIOverview</a>
              </li>
              <li>
                <a href="Drupal.file.html">Drupal.file</a>
              </li>
              <li>
                <a href="Drupal.filterConfiguration.html">Drupal.filterConfiguration</a>
              </li>
              <li>
                <a href="Drupal.filterConfiguration.liveSettingParsers.html">Drupal.filterConfiguration.liveSettingParsers</a>
              </li>
              <li>
                <a href="Drupal.history.html">Drupal.history</a>
              </li>
              <li>
                <a href="Drupal.states.html">Drupal.states</a>
              </li>
              <li>
                <a href="Drupal.states.Trigger.states.html">Drupal.states.Trigger.states</a>
              </li>
              <li>
                <a href="Drupal.theme.html">Drupal.theme</a>
              </li>
              <li>
                <a href="Drupal.toolbar.html">Drupal.toolbar</a>
              </li>
              <li>
                <a href="Drupal.tour.html">Drupal.tour</a>
              </li>
              <li>
                <a href="Drupal.tour.models.html">Drupal.tour.models</a>
              </li>
              <li>
                <a href="Drupal.tour.views.html">Drupal.tour.views</a>
              </li>
              <li>
                <a href="Drupal.Views.html">Drupal.Views</a>
              </li>
              <li>
                <a href="Drupal.views_.html">Drupal.views</a>
              </li>
              <li>
                <a href="Drupal.viewsUi.html">Drupal.viewsUi</a>
              </li>
            </ul>
            <h3>
              Global
            </h3>
            <ul>
              <li>
                <a href="global.html#drupalSettings" class="root">drupalSettings</a>
              </li>
              <li>
                <a href="global.html#matchMedia" class="root">matchMedia</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div><script type="text/javascript">
prettyPrint();
    </script><script src="scripts/linenumber.js" type="text/javascript">
</script>
  </body>
</html>
